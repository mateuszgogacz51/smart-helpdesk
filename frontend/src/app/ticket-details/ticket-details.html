<div class="details-container">
  
  <button class="back-btn" (click)="goBack()">â† WrÃ³Ä‡ do listy</button>

  <div *ngIf="!ticket && !errorMessage" class="loading">â³ Åadowanie danych...</div>
  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

  <div class="ticket-card" *ngIf="ticket">
    
    <header class="card-header">
      <div class="title-group">
        <span class="ticket-id">#{{ ticket.id }}</span>
        <h1>{{ ticket.title }}</h1>
      </div>
      <span class="status-badge" [ngClass]="getStatusClass(ticket.status)">
        {{ ticket.status }}
      </span>
    </header>

    <div class="card-body">
      
      <section class="description-section">
        <h3>Opis zgÅ‚oszenia</h3>
        <p>{{ ticket.description }}</p>
      </section>

      <hr class="divider">

      <div class="info-grid">
        <div class="info-group">
          <label>ZgÅ‚aszajÄ…cy:</label>
          <p><strong>{{ ticket.author?.firstName }} {{ ticket.author?.lastName }}</strong></p>
          <p class="sub-text">{{ ticket.author?.email }}</p>
          <p class="sub-text" style="color: #0056b3;">
            DziaÅ‚: <strong>{{ ticket.author?.department || 'Brak danych' }}</strong>
          </p>
        </div>

        <div class="info-group">
          <label>SzczegÃ³Å‚y:</label>
          <p>ğŸ“ Lokalizacja: <strong>{{ ticket.location }}</strong></p>
          <p>ğŸ“‚ Kategoria: <strong>{{ ticket.category }}</strong></p>
          <p>ğŸ“… Data: {{ ticket.createdDate | date:'medium' }}</p>
          <p *ngIf="ticket.lastUpdated" class="sub-text">ğŸ•’ Ost. zmiana: {{ ticket.lastUpdated | date:'short' }}</p>
        </div>

        <div class="info-group">
          <label>Osoba obsÅ‚ugujÄ…ca:</label>
          <p *ngIf="ticket.assignedUser">
            ğŸ‘¨â€ğŸ’» {{ ticket.assignedUser.firstName }}
          </p>
          <p *ngIf="!ticket.assignedUser" style="color: #999; font-style: italic;">
            Brak przypisania
          </p>
        </div>
      </div>

      <div class="admin-panel" *ngIf="currentUserRole === 'HELPDESK' || currentUserRole === 'ADMIN'">
        <h3>ğŸ› ï¸ Centrum ZarzÄ…dzania</h3>
        
        <div class="control-grid">
          
          <div class="control-box">
            <label>ğŸ‘¤ Osoba odpowiedzialna</label>
            <div class="input-group">
              <select [(ngModel)]="selectedStaffId" class="modern-select">
                <option [ngValue]="null">-- Nieprzypisane --</option>
                <option *ngFor="let staff of staffList" [value]="staff.id">
                  {{ staff.firstName }} ({{ staff.role }})
                </option>
              </select>
              <button type="button" class="save-btn" (click)="assignToSelectedUser()">
                Zapisz
              </button>
            </div>
          </div>

          <div class="control-box">
            <label>ğŸš¦ Status zgÅ‚oszenia</label>
            <div class="input-group">
              
              <select [(ngModel)]="selectedStatus" class="modern-select">
                <option value="OPEN">ğŸŸ¢ Otwarte (OPEN)</option>
                <option value="IN_PROGRESS">ğŸŸ  W toku (IN_PROGRESS)</option>
                <option value="CLOSED">âš« ZamkniÄ™te (CLOSED)</option>
              </select>

              <button type="button" class="save-btn" (click)="updateStatusManual()">
                ZmieÅ„ status
              </button>
              
            </div>
          </div>

        </div>
      </div>

      <hr class="divider">
      
      <section class="comments-section">
        <h3>ğŸ’¬ Dyskusja ({{ comments.length }})</h3>

        <div class="comments-list">
          
          <div *ngFor="let comment of comments" class="comment-bubble"
               [ngClass]="{'my-comment': comment.author.username === currentUsername, 
                           'other-comment': comment.author.username !== currentUsername}">
            
            <div class="comment-header">
              <strong>{{ comment.author.firstName }} {{ comment.author.lastName }}</strong>
              <span class="comment-date">{{ comment.createdDate | date:'short' }}</span>
            </div>
            
            <p class="comment-text">{{ comment.content }}</p>
          </div>

          <p *ngIf="comments.length === 0" class="no-comments">
            Brak wiadomoÅ›ci. Rozpocznij dyskusjÄ™! ğŸ‘‡
          </p>
        </div>

        <div class="add-comment-box">
          <textarea [(ngModel)]="newCommentContent" placeholder="Napisz wiadomoÅ›Ä‡..."></textarea>
          <button class="send-btn" (click)="addComment()" [disabled]="!newCommentContent.trim()">
            WyÅ›lij âœˆï¸
          </button>
        </div>
      </section>

    </div>
  </div>
</div>