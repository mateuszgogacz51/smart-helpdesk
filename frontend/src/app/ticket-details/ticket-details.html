<div class="details-container" *ngIf="ticket">
  
  <button class="back-btn" (click)="goBack()">‚Üê Wr√≥ƒá do listy</button>

  <div class="ticket-header">
    <div class="header-left">
      <h1>{{ ticket?.title }} <span class="id-tag">#{{ ticket?.id }}</span></h1>
      <div class="meta-info">
        <span class="category-badge">{{ ticket?.category }}</span>
        <span class="date">Utworzono: {{ ticket?.createdDate | date:'medium' }}</span>
        <span class="author">Autor: <strong>{{ ticket?.author?.username }}</strong></span>
      </div>
    </div>
    
    <div class="header-right">
      <div class="status-box" [ngClass]="ticket?.status || ''">
        STATUS: {{ ticket?.status }}
      </div>
      
      <div class="assigned-box" *ngIf="ticket?.assignedUser">
        Przypisany do: <strong>{{ ticket?.assignedUser?.username }}</strong>
      </div>
      <div class="assigned-box unassigned" *ngIf="!ticket?.assignedUser">
        Nieprzypisane
      </div>
    </div>
  </div>

  <div class="description-section">
    <h3>Opis zg≈Çoszenia</h3>
    <p>{{ ticket?.description }}</p>
    <div *ngIf="ticket?.location" class="location-info">
      üìç Lokalizacja: {{ ticket?.location }}
    </div>
  </div>

  <div class="admin-panel" *ngIf="currentUserRole !== 'USER'">
    <h3>Panel Obs≈Çugi (Helpdesk/Admin)</h3>
    
    <div class="actions-grid">
      
      <div class="action-group">
        <label>Zmie≈Ñ status:</label>
        <div class="status-buttons">
          <button (click)="changeStatus('OPEN')" class="btn-open" [disabled]="ticket?.status === 'OPEN'">OPEN</button>
          <button (click)="changeStatus('IN_PROGRESS')" class="btn-progress" [disabled]="ticket?.status === 'IN_PROGRESS'">IN PROGRESS</button>
          <button (click)="changeStatus('CLOSED')" class="btn-closed" [disabled]="ticket?.status === 'CLOSED'">CLOSED</button>
        </div>
      </div>

      <div class="action-group">
        <label>Przypisz zg≈Çoszenie:</label>
        <div class="assign-controls">
          <button (click)="assignToMe()" class="btn-assign-me">Przypisz do mnie</button>
          
          <select #staffSelect (change)="assignToUser(staffSelect.value)" class="staff-select">
            <option value="" disabled selected>Przypisz do innej osoby...</option>
            <option *ngFor="let person of staffList" [value]="person?.id">
              {{ person?.username }} ({{ person?.role }})
            </option>
          </select>
        </div>
      </div>

    </div>
  </div>

  <div class="comments-section">
    <h3>Komentarze ({{ comments ? comments.length : 0 }})</h3>
    
    <div class="comments-list">
      <div *ngFor="let comment of comments" class="comment-bubble" 
           [class.my-comment]="comment?.author?.username === currentUsername">
        <div class="comment-header">
          <strong>{{ comment?.author?.username }}</strong>
          <span>{{ comment?.createdDate | date:'short' }}</span>
        </div>
        <p>{{ comment?.content }}</p>
      </div>

      <div *ngIf="!comments || comments.length === 0" class="no-comments">
        Brak komentarzy. BƒÖd≈∫ pierwszy!
      </div>
    </div>

    <div class="add-comment-box">
      <textarea [(ngModel)]="newCommentContent" placeholder="Napisz komentarz..."></textarea>
      <button (click)="addComment()">Wy≈õlij</button>
    </div>
  </div>

</div>

<div *ngIf="!ticket" style="padding: 20px; text-align: center;">
  <p>≈Åadowanie danych zg≈Çoszenia...</p>
</div>