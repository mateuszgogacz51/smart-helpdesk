<div class="details-container" *ngIf="ticket">
  
  <header class="details-header">
    <button class="back-btn" (click)="goBack()">â† WrÃ³Ä‡</button>
    <div class="header-info">
      <span class="ticket-id">#{{ ticket.id }}</span>
      <span class="created-date">ZgÅ‚oszono: {{ ticket.createdDate | date:'medium' }}</span>
    </div>
  </header>

  <div class="content-grid">
    
    <main class="main-content">
      <section class="ticket-card">
        <h1>{{ ticket.title }}</h1>
        <div class="description-box">
          <p>{{ ticket.description }}</p>
        </div>
      </section>

      <section class="comments-section">
        <h3>ğŸ’¬ Komentarze ({{ comments.length }})</h3>
        <div class="comments-list">
          <div class="comment-item" *ngFor="let comment of comments">
            <div class="comment-header">
              <strong>{{ comment.author?.username }}</strong>
              <span class="comment-date">{{ comment.createdDate | date:'short' }}</span>
            </div>
            <div class="comment-body">{{ comment.content }}</div>
          </div>
          <div *ngIf="comments.length === 0" class="no-comments">Brak komentarzy.</div>
        </div>
        <div class="add-comment-box">
          <textarea [(ngModel)]="newCommentContent" placeholder="Napisz komentarz..." rows="3"></textarea>
          <button class="send-btn" (click)="addComment()">WyÅ›lij</button>
        </div>
      </section>
    </main>

    <aside class="info-sidebar">
      
      <div class="info-group">
        <label>Status:</label>
        
        <select *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'" 
                [ngModel]="ticket.status" 
                (change)="changeStatus($event)"
                class="status-select">
          <option value="OPEN">Nowe</option>
          <option value="IN_PROGRESS">W trakcie</option>
          <option value="CLOSED">ZamkniÄ™te</option>
        </select>

        <div *ngIf="currentUserRole !== 'ADMIN' && currentUserRole !== 'HELPDESK'" class="value">
          <span class="status-badge" [ngClass]="ticket.status">{{ ticket.status }}</span>
        </div>
      </div>

      <div class="info-group" *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'">
        <label>Priorytet (Edycja):</label>
        <select [ngModel]="ticket.priority" 
                (change)="updatePriority($event)" 
                [class]="'priority-select ' + ticket.priority">
          <option value="LOW">Niski</option>
          <option value="NORMAL">Normalny</option>
          <option value="HIGH">ğŸ”¥ PILNE</option>
        </select>
      </div>
      <div class="info-group">
        <label>Kategoria:</label>
        <div class="value">{{ ticket.category }}</div>
      </div>

      <div class="info-group">
        <label>Lokalizacja:</label>
        <div class="value">{{ ticket.location }}</div>
      </div>

      <div class="info-group">
        <label>ZgÅ‚aszajÄ…cy:</label>
        <div class="value user-value">ğŸ‘¤ {{ ticket.author?.username }}</div>
      </div>

      <div class="info-group">
        <label>Przypisano do:</label>
        
        <div *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'">
           <select [ngModel]="ticket.assignedUser?.id" (change)="assignTicket($event)" class="assign-select">
             <option [ngValue]="null">-- Nie przypisano --</option>
             <option *ngFor="let staff of supportStaff" [value]="staff.id">
               {{ staff.username }} ({{ staff.role }})
             </option>
           </select>
           <button class="assign-me-btn" (click)="assignToMe()">BiorÄ™ to!</button>
        </div>

        <div *ngIf="currentUserRole !== 'ADMIN' && currentUserRole !== 'HELPDESK'" class="value">
          <span *ngIf="ticket.assignedUser">{{ ticket.assignedUser?.username }}</span>
          <span *ngIf="!ticket.assignedUser" style="color: #bdc3c7;">Oczekuje na przypisanie</span>
        </div>
      </div>

      <div class="info-footer">
        <small>Ostatnia zmiana: {{ ticket.lastUpdated | date:'short' }}</small>
      </div>

    </aside>

  </div>
</div>