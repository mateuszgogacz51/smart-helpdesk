<div class="details-container" *ngIf="ticket">
  
  <div class="ticket-card">
    
    <div class="header-section">
      <div class="header-left">
        <button class="back-btn" (click)="goBack()">‚Üê Wr√≥ƒá</button>
        <h1>{{ ticket.title }} <span class="id-tag">#{{ ticket.id }}</span></h1>
        <div class="meta">
          <span class="category-tag">{{ ticket.category }}</span>
          <span>Autor: <strong>{{ ticket.author?.username }}</strong></span> &bull;
          <span>{{ ticket.createdDate | date:'medium' }}</span>
        </div>
      </div>
      
      <div class="header-right">
        <div class="status-box" [ngClass]="ticket.status">{{ ticket.status }}</div>
        <div class="assignee">
          Przypisany: 
          <strong *ngIf="ticket.assignedUser">{{ ticket.assignedUser.username }}</strong>
          <span *ngIf="!ticket.assignedUser" style="color:red">Brak</span>
        </div>
      </div>
    </div>

    <div class="content-section">
      <p>{{ ticket.description }}</p>
      <div *ngIf="ticket.location" style="margin-top:10px; font-size:14px; color:#7f8c8d;">
        üìç Lokalizacja: {{ ticket.location }}
      </div>
    </div>

    <div class="admin-panel" *ngIf="currentUserRole !== 'USER'">
      <h3>Panel ZarzƒÖdzania</h3>
      
      <div class="actions-row">
        
        <div class="action-col">
          <label>Zmie≈Ñ Status</label>
          <div class="control-wrapper">
            <select [(ngModel)]="selectedStatus" class="custom-select">
              <option value="OPEN">OPEN</option>
              <option value="IN_PROGRESS">IN_PROGRESS</option>
              <option value="CLOSED">CLOSED</option>
            </select>
            <button class="action-btn blue-btn" (click)="updateTicketStatus()">OK</button>
          </div>
        </div>

        <div class="action-col">
          <label>Przypisz Pracownika</label>
          <div class="control-wrapper">
            <select [(ngModel)]="selectedAssigneeId" class="custom-select">
              <option [ngValue]="null" disabled selected>Wybierz...</option>
              <option *ngFor="let staff of staffList" [ngValue]="staff.id">
                {{ staff.username }}
              </option>
            </select>
            <button class="action-btn green-btn" (click)="assignSelectedUser()">Przypisz</button>
            <button class="action-btn small-btn" (click)="assignToMe()">Ja</button>
          </div>
        </div>

      </div>
    </div>

    <div class="comments-section">
      <h3>Komentarze</h3>
      
      <div *ngFor="let c of comments" class="comment-bubble" 
           [class.my-comment]="c.author?.username === currentUsername">
        <div class="comment-header">
          <strong>{{ c.author?.username }}</strong>
          <span>{{ c.createdDate | date:'short' }}</span>
        </div>
        <div>{{ c.content }}</div>
      </div>

      <div *ngIf="comments.length === 0" style="color:#bdc3c7; text-align:center; padding:10px;">
        Brak komentarzy.
      </div>

      <div class="add-comment-box">
        <textarea [(ngModel)]="newCommentContent" placeholder="Dodaj notatkƒô..."></textarea>
        <button (click)="addComment()">Wy≈õlij</button>
      </div>
    </div>

  </div>
</div>