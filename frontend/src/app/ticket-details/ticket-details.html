<div class="dashboard-container" *ngIf="ticket; else loadingTemplate">
  
  <header class="details-header">
    <button class="back-btn" (click)="goBack()">â† WrÃ³Ä‡</button>
    <h2 class="section-title">SzczegÃ³Å‚y zgÅ‚oszenia #{{ ticket.id }}</h2>
  </header>

  <div class="content-grid">
    
    <main class="main-column">
      
      <section class="card-panel ticket-card">
        <div class="card-header-row">
          <h1 class="ticket-title">{{ ticket.title }}</h1>
          <span class="date-badge">{{ ticket.createdDate | date:'medium' }}</span>
        </div>
        <div class="description-box">
          <p>{{ ticket.description }}</p>
        </div>
      </section>

      <section class="card-panel comments-section">
        <h3 class="panel-title">ğŸ’¬ Komentarze ({{ comments.length }})</h3>
        
        <div class="comments-list">
          <div class="comment-item" *ngFor="let comment of comments">
            <div class="comment-meta">
              <strong>{{ comment.author?.username }}</strong>
              <span class="comment-date">{{ comment.createdDate | date:'short' }}</span>
            </div>
            <div class="comment-body">{{ comment.content }}</div>
          </div>
          <div *ngIf="comments.length === 0" class="empty-state">Brak komentarzy. BÄ…dÅº pierwszy!</div>
        </div>

        <div class="add-comment-area">
          <textarea [(ngModel)]="newCommentContent" placeholder="Napisz komentarz..." rows="3" class="styled-input"></textarea>
          <button class="save-btn" (click)="addComment()">WyÅ›lij komentarz</button>
        </div>
      </section>
    </main>

    <aside class="sidebar-column">
      
      <div class="card-panel info-card">
        <h3 class="panel-title">Informacje</h3>

        <div class="info-group">
          <label>Status</label>
          <select *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'" 
                  [ngModel]="ticket.status" 
                  (change)="changeStatus($event)"
                  class="styled-select status-select">
            <option value="OPEN">Nowe</option>
            <option value="IN_PROGRESS">W trakcie</option>
            <option value="CLOSED">ZamkniÄ™te</option>
          </select>
          <div *ngIf="currentUserRole !== 'ADMIN' && currentUserRole !== 'HELPDESK'">
            <span class="status-badge" [ngClass]="ticket.status">{{ ticket.status }}</span>
          </div>
        </div>

        <div class="info-group" *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'">
          <label>Priorytet</label>
          <select [ngModel]="ticket.priority" 
                  (change)="updatePriority($event)" 
                  class="styled-select">
            <option value="LOW">Niski</option>
            <option value="NORMAL">Normalny</option>
            <option value="HIGH">ğŸ”¥ PILNE</option>
          </select>
        </div>

        <div class="info-group">
          <label>Kategoria</label>
          <div class="value-text">{{ ticket.category }}</div>
        </div>

        <div class="info-group">
          <label>ZgÅ‚aszajÄ…cy</label>
          <div class="value-text user-value">ğŸ‘¤ {{ ticket.author?.username }}</div>
        </div>

        <div class="info-group">
          <label>Przypisano do</label>
          <div *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'">
             <select [ngModel]="ticket.assignedUser?.id" (change)="assignTicket($event)" class="styled-select">
               <option [ngValue]="null">-- Brak --</option>
               <option *ngFor="let staff of supportStaff" [value]="staff.id">
                 {{ staff.username }}
               </option>
             </select>
             <button class="action-btn-small" (click)="assignToMe()">Przypisz mnie</button>
          </div>
          <div *ngIf="currentUserRole !== 'ADMIN' && currentUserRole !== 'HELPDESK'">
            <span class="value-text">{{ ticket.assignedUser?.username || 'Oczekuje...' }}</span>
          </div>
        </div>
      </div>

    </aside>
  </div>
</div>

<ng-template #loadingTemplate>
  <div class="loading-state">
    <h2>â³ Åadowanie danych...</h2>
  </div>
</ng-template>