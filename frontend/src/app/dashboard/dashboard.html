<div class="dashboard-container">
  
  <header class="top-bar">
    <div class="welcome-section">
      <h2>Smart Helpdesk</h2>
    </div>
    <div class="user-info">
      <span>Witaj, <strong>{{ currentUser }}</strong> ({{ currentUserRole }})</span>
      <button class="logout-btn" (click)="logout()">Wyloguj</button>
    </div>
  </header>

  <div class="content-area">

    <div class="stats-container" *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'">
      
      <div class="stats-group">
        <h3>Moje Zadania (Przypisane)</h3>
        <div class="cards-row">
            <div class="stat-card blue clickable" (click)="viewMode = 'MY'; setFilter('OPEN')">
                <span class="count">{{ stats.myOpen }}</span>
                <span class="label">Nowe</span>
            </div>
            <div class="stat-card orange clickable" (click)="viewMode = 'MY'; setFilter('IN_PROGRESS')">
                <span class="count">{{ stats.myInProgress }}</span>
                <span class="label">W trakcie</span>
            </div>
            <div class="stat-card green clickable" (click)="viewMode = 'MY'; setFilter('CLOSED')">
                <span class="count">{{ stats.myClosed }}</span>
                <span class="label">Gotowe</span>
            </div>
        </div>
      </div>

      <div class="stats-group">
        <h3>CaÅ‚a Firma</h3>
        <div class="cards-row">
             <div class="stat-card blue clickable" (click)="viewMode = 'ALL'; setFilter('OPEN')">
                 <span class="count">{{ stats.globalOpen }}</span>
                 <span class="label">Wszystkie Nowe</span>
             </div>
             <div class="stat-card dark clickable" (click)="viewMode = 'ALL'; setFilter('ALL')">
                 <span class="count">{{ stats.globalTotal }}</span>
                 <span class="label">Razem</span>
             </div>
        </div>
      </div>
    </div>

    <div class="action-bar">
      
      <div class="view-toggle" *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'">
        <button [class.active]="viewMode === 'ALL'" (click)="viewMode = 'ALL'; setFilter('ALL')">Wszystkie</button>
        <button [class.active]="viewMode === 'MY'" (click)="viewMode = 'MY'; setFilter('ALL')">Tylko moje</button>
      </div>
      
      <div class="search-box">
        <input type="text" placeholder="ðŸ” Szukaj..." [(ngModel)]="searchTerm" (ngModelChange)="applyFilters()">
      </div>

      <div style="display: flex; gap: 10px;">
        <button *ngIf="currentUserRole === 'ADMIN'" class="add-btn" style="background: #2c3e50;" (click)="router.navigate(['/users'])">
            ðŸ‘¥ UÅ¼ytkownicy
        </button>
        <button class="add-btn" (click)="goToAddTicket()">+ Nowe zgÅ‚oszenie</button>
      </div>
    </div>

    <div class="table-wrapper">
      <table class="tickets-table">
        <thead>
          <tr>
            <th (click)="sortTable('id')">ID</th>
            <th (click)="sortTable('title')">TytuÅ‚</th>
            <th (click)="sortTable('status')">Status</th>
            
            <th *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'" 
                (click)="sortTable('priority')">
                Priorytet
            </th> 

            <th (click)="sortTable('category')">Kategoria</th>
            <th (click)="sortTable('author.username')">Autor</th>
            <th (click)="sortTable('assignedUser.username')">Przypisany</th>
            <th>Data</th>
            <th>Akcja</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ticket of visibleTickets">
            <td>#{{ ticket.id }}</td>
            <td><strong>{{ ticket.title }}</strong></td>
            <td><span class="status-badge" [ngClass]="ticket.status">{{ ticket.status }}</span></td>
            
            <td *ngIf="currentUserRole === 'ADMIN' || currentUserRole === 'HELPDESK'">
              <span *ngIf="ticket.priority === 'HIGH'" class="priority-badge high">ðŸ”¥ PILNE</span>
              <span *ngIf="ticket.priority === 'NORMAL'" class="priority-badge normal">Normalny</span>
              <span *ngIf="ticket.priority === 'LOW'" class="priority-badge low">Niski</span>
              <span *ngIf="!ticket.priority">-</span>
            </td>

            <td>{{ ticket.category }}</td>
            <td>{{ ticket.author?.username }}</td>
            <td>{{ ticket.assignedUser?.username || 'Brak' }}</td>
            <td>{{ ticket.createdDate | date:'short' }}</td>
            <td>
              <button class="details-btn" (click)="goToDetails(ticket.id!)">PodglÄ…d</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="visibleTickets.length === 0" style="padding: 20px; text-align: center; color: #888;">
          Brak zgÅ‚oszeÅ„ speÅ‚niajÄ…cych kryteria.
      </div>
    </div>
  </div>
</div>