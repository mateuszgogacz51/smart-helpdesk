<div class="dashboard-container">
  
  <header class="top-bar">
    <div class="title-section">
      <button (click)="goBack()" class="back-btn">‚Üê Wr√≥ƒá</button>
      <h2>ZarzƒÖdzanie U≈ºytkownikami</h2>
    </div>

    <div class="actions">
      <button (click)="openAddModal()" class="add-btn">
        + Dodaj Pracownika
      </button>
    </div>
  </header>

  <div class="content-area">
    
    <div class="search-hero">
        <div class="search-wrapper">
            <span class="search-icon">üîç</span>
            <input type="text" 
                   placeholder="Szukaj pracownika po nazwisku, loginie, dziale..." 
                   [(ngModel)]="searchTerm" (input)="filterUsers()">
        </div>
    </div>

    <div class="table-wrapper">
      <table class="users-table">
        <thead>
          <tr>
            <th (click)="sortTable('id')" class="sortable">
                ID <span *ngIf="sortColumn === 'id'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
            </th>
            <th (click)="sortTable('username')" class="sortable">
                Login <span *ngIf="sortColumn === 'username'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
            </th>
            <th (click)="sortTable('lastName')" class="sortable">
                Nazwisko <span *ngIf="sortColumn === 'lastName'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
            </th>
            <th (click)="sortTable('role')" class="sortable">
                Rola <span *ngIf="sortColumn === 'role'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
            </th>
            <th (click)="sortTable('department')" class="sortable">
                Dzia≈Ç <span *ngIf="sortColumn === 'department'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
            </th>
            <th (click)="sortTable('defaultPriority')" class="sortable">
                Priorytet <span *ngIf="sortColumn === 'defaultPriority'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
            </th>
            <th>Akcje</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of visibleUsers">
            <td>#{{ user.id }}</td>
            <td><strong>{{ user.username }}</strong></td>
            <td>{{ user.firstName }} {{ user.lastName }}</td>
            <td>
              <span class="role-badge" [ngClass]="user.role">{{ user.role }}</span>
            </td>
            <td>{{ user.department || '-' }}</td>
            <td>{{ user.defaultPriority || 'NORMAL' }}</td>
            <td style="display: flex; gap: 8px;">
              <button class="action-btn edit" (click)="editUser(user)">‚úèÔ∏è</button>
              <button class="action-btn delete" (click)="deleteUser(user)">üóëÔ∏è</button>
            </td>
          </tr>
        </tbody>
      </table>
      
      <div *ngIf="visibleUsers.length === 0" class="empty-state">
        Brak u≈ºytkownik√≥w pasujƒÖcych do wyszukiwania.
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showModal">
    <div class="modal-box">
      <h3>{{ isEditing ? 'Edytuj U≈ºytkownika' : 'Nowy Pracownik' }}</h3>
      
      <form (ngSubmit)="saveUser()" #userForm="ngForm">
        
        <div class="form-group">
          <label>Login <span style="color:red">*</span></label>
          <input [(ngModel)]="newUser.username" name="username" required minlength="3" 
                 #username="ngModel" placeholder="Min. 3 znaki">
          <div *ngIf="username.invalid && (username.dirty || username.touched)" class="error-msg">
            Login wymagany (min. 3).
          </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Imiƒô</label>
                <input [(ngModel)]="newUser.firstName" name="firstName">
            </div>
            <div class="form-group">
                <label>Nazwisko</label>
                <input [(ngModel)]="newUser.lastName" name="lastName">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Dzia≈Ç</label>
                <input [(ngModel)]="newUser.department" name="department">
            </div>
            <div class="form-group">
                <label>Telefon</label>
                <input [(ngModel)]="newUser.phoneNumber" name="phoneNumber" pattern="[0-9]{9}" #phone="ngModel">
                <div *ngIf="phone.invalid && (phone.dirty || phone.touched)" class="error-msg">9 cyfr.</div>
            </div>
        </div>

        <div class="form-group">
          <label>Email</label>
          <input [(ngModel)]="newUser.email" name="email" type="email" email #emailField="ngModel">
          <div *ngIf="emailField.invalid && (emailField.dirty || emailField.touched)" class="error-msg">B≈Çƒôdny email.</div>
        </div>

        <div class="form-group">
          <label>Has≈Ço</label>
          <input [(ngModel)]="newUser.password" name="password" type="password" 
                 [required]="!isEditing" minlength="4" #pass="ngModel">
          <div *ngIf="pass.invalid && (pass.dirty || pass.touched)" class="error-msg">Min. 4 znaki.</div>
        </div>

        <div class="form-row">
            <div class="form-group">
              <label>Rola</label>
              <select [(ngModel)]="newUser.role" name="role" required>
                <option value="USER">U≈ºytkownik</option>
                <option value="HELPDESK">Serwisant</option>
                <option value="ADMIN">Administrator</option>
              </select>
            </div>
            <div class="form-group">
              <label>Domy≈õlny Priorytet</label>
              <select [(ngModel)]="newUser.defaultPriority" name="defaultPriority">
                <option value="LOW">Niski</option>
                <option value="NORMAL">Normalny</option>
                <option value="HIGH">Wysoki</option>
              </select>
            </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeModal()">Anuluj</button>
          <button type="submit" class="save-btn" [disabled]="!userForm.form.valid">Zapisz</button>
        </div>
      </form>
    </div>
  </div>
</div>